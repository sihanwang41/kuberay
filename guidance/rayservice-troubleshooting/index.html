
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ray-project.github.io/kuberay/guidance/rayservice-troubleshooting/">
      
      
        <link rel="prev" href="../FAQ/">
      
      
        <link rel="next" href="../../development/development/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>RayService Troubleshooting - KubeRay Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rayservice-troubleshooting" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="KubeRay Docs" class="md-header__button md-logo" aria-label="KubeRay Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubeRay Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RayService Troubleshooting
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ray-project/kuberay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/kuberay
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Home
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../components/operator/" class="md-tabs__link">
        Components
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../rayservice/" class="md-tabs__link">
        Features
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../FAQ/" class="md-tabs__link md-tabs__link--active">
        Troubleshooting
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../development/development/" class="md-tabs__link">
        Development
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="KubeRay Docs" class="md-nav__button md-logo" aria-label="KubeRay Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    KubeRay Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ray-project/kuberay" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ray-project/kuberay
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" tabindex="0" aria-expanded="false">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Home" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Home
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Welcome
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2" tabindex="0" aria-expanded="false">
          Getting Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Getting Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_1_2_1" type="checkbox" id="__nav_1_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1_2_1" tabindex="0" aria-expanded="false">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="3">
        <label class="md-nav__title" for="__nav_1_2_1">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/installation/" class="md-nav__link">
        YAML
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/helm/" class="md-nav__link">
        Helm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/helm-cluster/" class="md-nav__link">
        Helm (Cluster)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../deploy/docker.md" class="md-nav__link">
        Docker Images
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          Components
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Components" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Components
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/operator/" class="md-nav__link">
        KubeRay Operator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/apiserver/" class="md-nav__link">
        KubeRay API Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../components/cli/" class="md-nav__link">
        KubeRay CLI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="false">
          Features
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Features" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Features
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rayservice/" class="md-nav__link">
        RayService
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rayjob/" class="md-nav__link">
        RayJob
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gcs-ft/" class="md-nav__link">
        Ray GCS Fault Tolerance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../autoscaler/" class="md-nav__link">
        Autoscaling
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" tabindex="0" aria-expanded="false">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ingress/" class="md-nav__link">
        Ingress
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tls/" class="md-nav__link">
        TLS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
        <label class="md-nav__link" for="__nav_3_6" tabindex="0" aria-expanded="false">
          Monitoring and Observability
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Monitoring and Observability" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Monitoring and Observability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../observability/" class="md-nav__link">
        Observability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../prometheus-grafana/" class="md-nav__link">
        Prometheus and Grafana
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../profiling/" class="md-nav__link">
        Profiling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
        <label class="md-nav__link" for="__nav_3_7" tabindex="0" aria-expanded="false">
          Security
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Security" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Security
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aws-eks-iam/" class="md-nav__link">
        IAM Roles (AWS EKS)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pod-security/" class="md-nav__link">
        Pod Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
        <label class="md-nav__link" for="__nav_3_8" tabindex="0" aria-expanded="false">
          Integrations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Integrations" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Integrations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kuberay-with-MCAD/" class="md-nav__link">
        KubeRay with MCAD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../volcano-integration/" class="md-nav__link">
        KubeRay with Volcano
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubeflow-integration/" class="md-nav__link">
        Kubeflow Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
        <label class="md-nav__link" for="__nav_3_9" tabindex="0" aria-expanded="false">
          Best Practices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Best Practices" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Best Practices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pod-command/" class="md-nav__link">
        Executing Commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practice/worker-head-reconnection/" class="md-nav__link">
        Worker Reconnection
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="true">
          Troubleshooting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Troubleshooting" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Troubleshooting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RayService Troubleshooting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        RayService Troubleshooting
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#observability" class="md-nav__link">
    Observability
  </a>
  
    <nav class="md-nav" aria-label="Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-check-kuberay-operators-logs-for-errors" class="md-nav__link">
    Method 1: Check KubeRay operator's logs for errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-check-rayservice-cr-status" class="md-nav__link">
    Method 2: Check RayService CR status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-3-check-logs-of-ray-pods" class="md-nav__link">
    Method 3: Check logs of Ray Pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-4-check-dashboard" class="md-nav__link">
    Method 4: Check Dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-5-ray-state-cli" class="md-nav__link">
    Method 5: Ray State CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    Common issues
  </a>
  
    <nav class="md-nav" aria-label="Common issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-ray-serve-script-is-incorrect" class="md-nav__link">
    Issue 1: Ray Serve script is incorrect.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-serveconfigv2-is-incorrect" class="md-nav__link">
    Issue 2: serveConfigV2 is incorrect.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-1-the-ray-image-does-not-include-the-required-dependencies" class="md-nav__link">
    Issue 3-1: The Ray image does not include the required dependencies.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-2-examples-for-troubleshooting-dependency-issues" class="md-nav__link">
    Issue 3-2: Examples for troubleshooting dependency issues.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-4-incorrect-import_path" class="md-nav__link">
    Issue 4: Incorrect import_path.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-5-fail-to-create-update-serve-applications" class="md-nav__link">
    Issue 5: Fail to create / update Serve applications.
  </a>
  
    <nav class="md-nav" aria-label="Issue 5: Fail to create / update Serve applications.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-message-1-connect-connection-refused" class="md-nav__link">
    Error message 1: connect: connection refused
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-message-2-io-timeout" class="md-nav__link">
    Error message 2: i/o timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-6-runtime_env" class="md-nav__link">
    Issue 6: runtime_env
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-7-failed-to-get-serve-application-statuses" class="md-nav__link">
    Issue 7: Failed to get Serve application statuses.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-8-a-loop-of-restarting-the-raycluster-occurs-when-the-kubernetes-cluster-runs-out-of-resources-kuberay-v061-or-earlier" class="md-nav__link">
    Issue 8: A loop of restarting the RayCluster occurs when the Kubernetes cluster runs out of resources. (KubeRay v0.6.1 or earlier)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/development/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5_2" type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" tabindex="0" aria-expanded="false">
          Release Process
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Release Process" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Release Process
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../development/release/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release/changelog/" class="md-nav__link">
        Generating the Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release/helm-chart/" class="md-nav__link">
        Releasing the Helm Chart
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#observability" class="md-nav__link">
    Observability
  </a>
  
    <nav class="md-nav" aria-label="Observability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#method-1-check-kuberay-operators-logs-for-errors" class="md-nav__link">
    Method 1: Check KubeRay operator's logs for errors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-2-check-rayservice-cr-status" class="md-nav__link">
    Method 2: Check RayService CR status
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-3-check-logs-of-ray-pods" class="md-nav__link">
    Method 3: Check logs of Ray Pods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-4-check-dashboard" class="md-nav__link">
    Method 4: Check Dashboard
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#method-5-ray-state-cli" class="md-nav__link">
    Method 5: Ray State CLI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    Common issues
  </a>
  
    <nav class="md-nav" aria-label="Common issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#issue-1-ray-serve-script-is-incorrect" class="md-nav__link">
    Issue 1: Ray Serve script is incorrect.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-2-serveconfigv2-is-incorrect" class="md-nav__link">
    Issue 2: serveConfigV2 is incorrect.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-1-the-ray-image-does-not-include-the-required-dependencies" class="md-nav__link">
    Issue 3-1: The Ray image does not include the required dependencies.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-3-2-examples-for-troubleshooting-dependency-issues" class="md-nav__link">
    Issue 3-2: Examples for troubleshooting dependency issues.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-4-incorrect-import_path" class="md-nav__link">
    Issue 4: Incorrect import_path.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-5-fail-to-create-update-serve-applications" class="md-nav__link">
    Issue 5: Fail to create / update Serve applications.
  </a>
  
    <nav class="md-nav" aria-label="Issue 5: Fail to create / update Serve applications.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-message-1-connect-connection-refused" class="md-nav__link">
    Error message 1: connect: connection refused
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-message-2-io-timeout" class="md-nav__link">
    Error message 2: i/o timeout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-6-runtime_env" class="md-nav__link">
    Issue 6: runtime_env
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-7-failed-to-get-serve-application-statuses" class="md-nav__link">
    Issue 7: Failed to get Serve application statuses.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#issue-8-a-loop-of-restarting-the-raycluster-occurs-when-the-kubernetes-cluster-runs-out-of-resources-kuberay-v061-or-earlier" class="md-nav__link">
    Issue 8: A loop of restarting the RayCluster occurs when the Kubernetes cluster runs out of resources. (KubeRay v0.6.1 or earlier)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  





<h1 id="rayservice-troubleshooting">RayService troubleshooting<a class="headerlink" href="#rayservice-troubleshooting" title="Permanent link">&para;</a></h1>
<p>RayService is a Custom Resource Definition (CRD) designed for Ray Serve. In KubeRay, creating a RayService will first create a RayCluster and then
create Ray Serve applications once the RayCluster is ready. If the issue pertains to the data plane, specifically your Ray Serve scripts 
or Ray Serve configurations (<code>serveConfigV2</code>), troubleshooting may be challenging. This section provides some tips to help you debug these issues.</p>
<h2 id="observability">Observability<a class="headerlink" href="#observability" title="Permanent link">&para;</a></h2>
<h3 id="method-1-check-kuberay-operators-logs-for-errors">Method 1: Check KubeRay operator's logs for errors<a class="headerlink" href="#method-1-check-kuberay-operators-logs-for-errors" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$KUBERAY_OPERATOR_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>operator-log
</code></pre></div>
<p>The above command will redirect the operator's logs to a file called <code>operator-log</code>. You can then search for errors in the file.</p>
<h3 id="method-2-check-rayservice-cr-status">Method 2: Check RayService CR status<a class="headerlink" href="#method-2-check-rayservice-cr-status" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>rayservice<span class="w"> </span><span class="nv">$RAYSERVICE_NAME</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span>
</code></pre></div>
<p>You can check the status and events of the RayService CR to see if there are any errors.</p>
<h3 id="method-3-check-logs-of-ray-pods">Method 3: Check logs of Ray Pods<a class="headerlink" href="#method-3-check-logs-of-ray-pods" title="Permanent link">&para;</a></h3>
<p>You can also check the Ray Serve logs directly by accessing the log files on the pods. These log files contain system level logs from the Serve controller and HTTP proxy as well as access logs and user-level logs. See <a href="https://docs.ray.io/en/latest/serve/production-guide/monitoring.html#ray-logging">Ray Serve Logging</a> and <a href="https://docs.ray.io/en/latest/ray-observability/user-guides/configure-logging.html#configure-logging">Ray Logging</a> for more details.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$RAY_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span>--<span class="w"> </span>bash
<span class="c1"># Check the logs under /tmp/ray/session_latest/logs/serve/</span>
</code></pre></div>
<h3 id="method-4-check-dashboard">Method 4: Check Dashboard<a class="headerlink" href="#method-4-check-dashboard" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>port-forward<span class="w"> </span><span class="nv">$RAY_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span>--address<span class="w"> </span><span class="m">0</span>.0.0.0<span class="w"> </span><span class="m">8265</span>:8265
<span class="c1"># Check $YOUR_IP:8265 in your browser</span>
</code></pre></div>
<p>For more details about Ray Serve observability on the dashboard, you can refer to <a href="https://docs.ray.io/en/latest/ray-observability/getting-started.html#serve-view">the documentation</a> and <a href="https://youtu.be/eqXfwM641a4">the YouTube video</a>.</p>
<h3 id="method-5-ray-state-cli">Method 5: Ray State CLI<a class="headerlink" href="#method-5-ray-state-cli" title="Permanent link">&para;</a></h3>
<p>You can use the <a href="https://docs.ray.io/en/latest/ray-observability/reference/cli.html">Ray State CLI</a> on the head Pod to check the status of Ray Serve applications.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Log into the head Pod</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">HEAD_POD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--selector<span class="o">=</span>ray.io/node-type<span class="o">=</span>head<span class="w"> </span>-o<span class="w"> </span>custom-columns<span class="o">=</span>POD:metadata.name<span class="w"> </span>--no-headers<span class="k">)</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$HEAD_POD</span><span class="w"> </span>--<span class="w"> </span>ray<span class="w"> </span>summary<span class="w"> </span>actors

<span class="c1"># [Example output]:</span>
<span class="c1"># ======== Actors Summary: 2023-07-11 17:58:24.625032 ========</span>
<span class="c1"># Stats:</span>
<span class="c1"># ------------------------------------</span>
<span class="c1"># total_actors: 14</span>


<span class="c1"># Table (group by class):</span>
<span class="c1"># ------------------------------------</span>
<span class="c1">#     CLASS_NAME                          STATE_COUNTS</span>
<span class="c1"># 0   ServeController                     ALIVE: 1</span>
<span class="c1"># 1   ServeReplica:fruit_app_OrangeStand  ALIVE: 1</span>
<span class="c1"># 2   HTTPProxyActor                      ALIVE: 3</span>
<span class="c1"># 3   ServeReplica:math_app_DAGDriver     ALIVE: 1</span>
<span class="c1"># 4   ServeReplica:math_app_Multiplier    ALIVE: 1</span>
<span class="c1"># 5   ServeReplica:math_app_create_order  ALIVE: 1</span>
<span class="c1"># 6   ServeReplica:fruit_app_DAGDriver    ALIVE: 1</span>
<span class="c1"># 7   ServeReplica:fruit_app_FruitMarket  ALIVE: 1</span>
<span class="c1"># 8   ServeReplica:math_app_Adder         ALIVE: 1</span>
<span class="c1"># 9   ServeReplica:math_app_Router        ALIVE: 1</span>
<span class="c1"># 10  ServeReplica:fruit_app_MangoStand   ALIVE: 1</span>
<span class="c1"># 11  ServeReplica:fruit_app_PearStand    ALIVE: 1</span>
</code></pre></div>
<h2 id="common-issues">Common issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h2>
<h3 id="issue-1-ray-serve-script-is-incorrect">Issue 1: Ray Serve script is incorrect.<a class="headerlink" href="#issue-1-ray-serve-script-is-incorrect" title="Permanent link">&para;</a></h3>
<p>We strongly recommend that you test your Ray Serve script locally or in a RayCluster before
deploying it to a RayService. Please refer to <a href="https://github.com/ray-project/kuberay/blob/master/docs/guidance/rayserve-dev-doc.md">rayserve-dev-doc.md</a> for more details.</p>
<h3 id="issue-2-serveconfigv2-is-incorrect">Issue 2: <code>serveConfigV2</code> is incorrect.<a class="headerlink" href="#issue-2-serveconfigv2-is-incorrect" title="Permanent link">&para;</a></h3>
<p>For the sake of flexibility, we have set <code>serveConfigV2</code> as a YAML multi-line string in the RayService CR.
This implies that there is no strict type checking for the Ray Serve configurations in <code>serveConfigV2</code> field.
Some tips to help you debug the <code>serveConfigV2</code> field:</p>
<ul>
<li>Check <a href="https://docs.ray.io/en/latest/serve/api/#put-api-serve-applications">the documentation</a> for the schema about
the Ray Serve Multi-application API <code>PUT "/api/serve/applications/"</code>.</li>
<li>Unlike <code>serveConfig</code>, <code>serveConfigV2</code> adheres to the snake case naming convention. For example, <code>numReplicas</code> is used in <code>serveConfig</code>, while <code>num_replicas</code> is used in <code>serveConfigV2</code>. </li>
</ul>
<h3 id="issue-3-1-the-ray-image-does-not-include-the-required-dependencies">Issue 3-1: The Ray image does not include the required dependencies.<a class="headerlink" href="#issue-3-1-the-ray-image-does-not-include-the-required-dependencies" title="Permanent link">&para;</a></h3>
<p>You have two options to resolve this issue:</p>
<ul>
<li>Build your own Ray image with the required dependencies.</li>
<li>Specify the required dependencies via <code>runtime_env</code> in <code>serveConfigV2</code> field.</li>
<li>For example, the MobileNet example requires <code>python-multipart</code>, which is not included in the Ray image <code>rayproject/ray-ml:2.5.0</code>.
Therefore, the YAML file includes <code>python-multipart</code> in the runtime environment. For more details, refer to <a href="../mobilenet-rayservice/">the MobileNet example</a>.</li>
</ul>
<h3 id="issue-3-2-examples-for-troubleshooting-dependency-issues">Issue 3-2: Examples for troubleshooting dependency issues.<a class="headerlink" href="#issue-3-2-examples-for-troubleshooting-dependency-issues" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: We highly recommend testing your Ray Serve script locally or in a RayCluster before deploying it to a RayService. This helps identify any dependency issues in the early stages. Please refer to <a href="https://github.com/ray-project/kuberay/blob/master/docs/guidance/rayserve-dev-doc.md">rayserve-dev-doc.md</a> for more details.</p>
</blockquote>
<p>In the <a href="../mobilenet-rayservice/">MobileNet example</a>, the <a href="https://github.com/ray-project/serve_config_examples/blob/master/mobilenet/mobilenet.py">mobilenet.py</a> consists of two functions: <code>__init__()</code> and <code>__call__()</code>.
The function <code>__call__()</code> will only be called when the Serve application receives a request.</p>
<ul>
<li>Example 1: Remove <code>python-multipart</code> from the runtime environment in <a href="../../ray-operator/config/samples/ray-service.mobilenet.yaml">the MobileNet YAML</a>.</li>
<li>The <code>python-multipart</code> library is only required for the <code>__call__</code> method. Therefore, we can only observe the dependency issue when we send a request to the application.</li>
<li>
<p>Example error message:
    <div class="highlight"><pre><span></span><code>Unexpected<span class="w"> </span>error,<span class="w"> </span>traceback:<span class="w"> </span>ray::ServeReplica:mobilenet_ImageClassifier.handle_request<span class="o">()</span><span class="w"> </span><span class="o">(</span><span class="nv">pid</span><span class="o">=</span><span class="m">226</span>,<span class="w"> </span><span class="nv">ip</span><span class="o">=</span><span class="m">10</span>.244.0.9<span class="o">)</span>
<span class="w">  </span>.
<span class="w">  </span>.
<span class="w">  </span>.
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;...&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">24</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>__call__
<span class="w">    </span><span class="nv">request</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>await<span class="w"> </span>http_request.form<span class="o">()</span>
<span class="w">  </span>File<span class="w"> </span><span class="s2">&quot;/home/ray/anaconda3/lib/python3.7/site-packages/starlette/requests.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">256</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>_get_form
<span class="w">    </span><span class="o">)</span>,<span class="w"> </span><span class="s2">&quot;The `python-multipart` library must be installed to use form parsing.&quot;</span>
AssertionError:<span class="w"> </span>The<span class="w"> </span><span class="sb">`</span>python-multipart<span class="sb">`</span><span class="w"> </span>library<span class="w"> </span>must<span class="w"> </span>be<span class="w"> </span>installed<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>form<span class="w"> </span>parsing..
</code></pre></div></p>
</li>
<li>
<p>Example 2: Update the image from <code>rayproject/ray-ml:2.5.0</code> to <code>rayproject/ray:2.5.0</code> in <a href="../../ray-operator/config/samples/ray-service.mobilenet.yaml">the MobileNet YAML</a>. The latter image does not include <code>tensorflow</code>.</p>
</li>
<li>The <code>tensorflow</code> library is imported in the <a href="https://github.com/ray-project/serve_config_examples/blob/master/mobilenet/mobilenet.py">mobilenet.py</a>.</li>
<li>Example error message:
    <div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>describe<span class="w"> </span>rayservices.ray.io<span class="w"> </span>rayservice-mobilenet

<span class="c1"># Example error message:</span>
Pending<span class="w"> </span>Service<span class="w"> </span>Status:
<span class="w">  </span>Application<span class="w"> </span>Statuses:
<span class="w">    </span>Mobilenet:
<span class="w">      </span>...
<span class="w">      </span>Message:<span class="w">                  </span>Deploying<span class="w"> </span>app<span class="w"> </span><span class="s1">&#39;mobilenet&#39;</span><span class="w"> </span>failed:
<span class="w">        </span>ray::deploy_serve_application<span class="o">()</span><span class="w"> </span><span class="o">(</span><span class="nv">pid</span><span class="o">=</span><span class="m">279</span>,<span class="w"> </span><span class="nv">ip</span><span class="o">=</span><span class="m">10</span>.244.0.12<span class="o">)</span>
<span class="w">            </span>...
<span class="w">          </span>File<span class="w"> </span><span class="s2">&quot;.../mobilenet/mobilenet.py&quot;</span>,<span class="w"> </span>line<span class="w"> </span><span class="m">4</span>,<span class="w"> </span><span class="k">in</span><span class="w"> </span>&lt;module&gt;
<span class="w">            </span>from<span class="w"> </span>tensorflow.keras.preprocessing<span class="w"> </span>import<span class="w"> </span>image
<span class="w">        </span>ModuleNotFoundError:<span class="w"> </span>No<span class="w"> </span>module<span class="w"> </span>named<span class="w"> </span><span class="s1">&#39;tensorflow&#39;</span>
</code></pre></div></li>
</ul>
<h3 id="issue-4-incorrect-import_path">Issue 4: Incorrect <code>import_path</code>.<a class="headerlink" href="#issue-4-incorrect-import_path" title="Permanent link">&para;</a></h3>
<p>You can refer to <a href="https://docs.ray.io/en/latest/serve/api/doc/ray.serve.schema.ServeApplicationSchema.html#ray.serve.schema.ServeApplicationSchema.import_path">the documentation</a> for more details about the format of <code>import_path</code>.
Taking <a href="../../ray-operator/config/samples/ray-service.mobilenet.yaml">the MobileNet YAML file</a> as an example,
the <code>import_path</code> is <code>mobilenet.mobilenet:app</code>. The first <code>mobilenet</code> is the name of the directory in the <code>working_dir</code>,
the second <code>mobilenet</code> is the name of the Python file in the directory <code>mobilenet/</code>,
and <code>app</code> is the name of the variable representing Ray Serve application within the Python file.</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="nt">serveConfigV2</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">applications:</span>
<span class="w">      </span><span class="no">- name: mobilenet</span>
<span class="w">        </span><span class="no">import_path: mobilenet.mobilenet:app</span>
<span class="w">        </span><span class="no">runtime_env:</span>
<span class="w">          </span><span class="no">working_dir: &quot;https://github.com/ray-project/serve_config_examples/archive/b393e77bbd6aba0881e3d94c05f968f05a387b96.zip&quot;</span>
<span class="w">          </span><span class="no">pip: [&quot;python-multipart==0.0.6&quot;]</span>
</code></pre></div>
<h3 id="issue-5-fail-to-create-update-serve-applications">Issue 5: Fail to create / update Serve applications.<a class="headerlink" href="#issue-5-fail-to-create-update-serve-applications" title="Permanent link">&para;</a></h3>
<p>You may encounter the following error messages when KubeRay tries to create / update Serve applications:</p>
<h4 id="error-message-1-connect-connection-refused">Error message 1: <code>connect: connection refused</code><a class="headerlink" href="#error-message-1-connect-connection-refused" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>Put &quot;http://${HEAD_SVC_FQDN}:52365/api/serve/applications/&quot;: dial tcp $HEAD_IP:52365: connect: connection refused
</code></pre></div>
<p>For RayService, the KubeRay operator submits a request to the RayCluster for creating Serve applications once the head Pod is ready.
It's important to note that the Dashboard, Dashboard Agent and GCS may take a few seconds to start up after the head Pod is ready.
As a result, the request may fail a few times initially before the necessary components are fully operational.</p>
<p>If you continue to encounter this issue after waiting for 1 minute, it's possible that the dashboard or dashboard agent may have failed to start.
For more information, you can check the <code>dashboard.log</code> and <code>dashboard_agent.log</code> files located at <code>/tmp/ray/session_latest/logs/</code> on the head Pod.</p>
<h4 id="error-message-2-io-timeout">Error message 2: <code>i/o timeout</code><a class="headerlink" href="#error-message-2-io-timeout" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code>Put &quot;http://${HEAD_SVC_FQDN}:52365/api/serve/applications/&quot;: dial tcp $HEAD_IP:52365: i/o timeout&quot;
</code></pre></div>
<p>One possible cause of this issue could be a Kubernetes NetworkPolicy blocking the traffic between the Ray Pods and the dashboard agent's port (i.e., 52365).</p>
<h3 id="issue-6-runtime_env">Issue 6: <code>runtime_env</code><a class="headerlink" href="#issue-6-runtime_env" title="Permanent link">&para;</a></h3>
<p>In <code>serveConfigV2</code>, you can specify the runtime environment for the Ray Serve applications via <code>runtime_env</code>.
Some common issues related to <code>runtime_env</code>:</p>
<ul>
<li>
<p>The <code>working_dir</code> points to a private AWS S3 bucket, but the Ray Pods do not have the necessary permissions to access the bucket.</p>
</li>
<li>
<p>The NetworkPolicy blocks the traffic between the Ray Pods and the external URLs specified in <code>runtime_env</code>.</p>
</li>
</ul>
<h3 id="issue-7-failed-to-get-serve-application-statuses">Issue 7: Failed to get Serve application statuses.<a class="headerlink" href="#issue-7-failed-to-get-serve-application-statuses" title="Permanent link">&para;</a></h3>
<p>You may encounter the following error message when KubeRay tries to get Serve application statuses:</p>
<div class="highlight"><pre><span></span><code>Get &quot;http://${HEAD_SVC_FQDN}:52365/api/serve/applications/&quot;: dial tcp $HEAD_IP:52365: connect: connection refused&quot;
</code></pre></div>
<p>As mentioned in <a href="#issue-5-fail-to-create--update-serve-applications">Issue 5</a>, the KubeRay operator submits a <code>Put</code> request to the RayCluster for creating Serve applications once the head Pod is ready.
After the successful submission of the <code>Put</code> request to the dashboard agent, a <code>Get</code> request is sent to the dashboard agent port (i.e., 52365). 
The successful submission indicates that all the necessary components, including the dashboard agent, are fully operational. 
Therefore, unlike Issue 5, the failure of the <code>Get</code> request is not expected.</p>
<p>If you consistently encounter this issue, there are several possible causes:</p>
<ul>
<li>The dashboard agent process on the head Pod is not running. You can check the <code>dashboard_agent.log</code> file located at <code>/tmp/ray/session_latest/logs/</code> on the head Pod for more information. In addition, you can also perform an experiment to reproduce this cause by manually killing the dashboard agent process on the head Pod.
  <div class="highlight"><pre><span></span><code><span class="c1"># Step 1: Log in to the head Pod</span>
kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$HEAD_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span>--<span class="w"> </span>bash

<span class="c1"># Step 2: Check the PID of the dashboard agent process</span>
ps<span class="w"> </span>aux
<span class="c1"># [Example output]</span>
<span class="c1"># ray          156 ... 0:03 /.../python -u /.../ray/dashboard/agent.py --</span>

<span class="c1"># Step 3: Kill the dashboard agent process</span>
<span class="nb">kill</span><span class="w"> </span><span class="m">156</span>

<span class="c1"># Step 4: Check the logs</span>
cat<span class="w"> </span>/tmp/ray/session_latest/logs/dashboard_agent.log

<span class="c1"># [Example output]</span>
<span class="c1"># 2023-07-10 11:24:31,962 INFO web_log.py:206 -- 10.244.0.5 [10/Jul/2023:18:24:31 +0000] &quot;GET /api/serve/applications/ HTTP/1.1&quot; 200 13940 &quot;-&quot; &quot;Go-http-client/1.1&quot;</span>
<span class="c1"># 2023-07-10 11:24:34,001 INFO web_log.py:206 -- 10.244.0.5 [10/Jul/2023:18:24:33 +0000] &quot;GET /api/serve/applications/ HTTP/1.1&quot; 200 13940 &quot;-&quot; &quot;Go-http-client/1.1&quot;</span>
<span class="c1"># 2023-07-10 11:24:36,043 INFO web_log.py:206 -- 10.244.0.5 [10/Jul/2023:18:24:36 +0000] &quot;GET /api/serve/applications/ HTTP/1.1&quot; 200 13940 &quot;-&quot; &quot;Go-http-client/1.1&quot;</span>
<span class="c1"># 2023-07-10 11:24:38,082 INFO web_log.py:206 -- 10.244.0.5 [10/Jul/2023:18:24:38 +0000] &quot;GET /api/serve/applications/ HTTP/1.1&quot; 200 13940 &quot;-&quot; &quot;Go-http-client/1.1&quot;</span>
<span class="c1"># 2023-07-10 11:24:38,590 WARNING agent.py:531 -- Exiting with SIGTERM immediately...</span>

<span class="c1"># Step 5: Open a new terminal and check the logs of the KubeRay operator</span>
kubectl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$KUBERAY_OPERATOR_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>operator-log

<span class="c1"># [Example output]</span>
<span class="c1"># Get \&quot;http://rayservice-sample-raycluster-rqlsl-head-svc.default.svc.cluster.local:52365/api/serve/applications/\&quot;: dial tcp 10.96.7.154:52365: connect: connection refused</span>
</code></pre></div></li>
</ul>
<h3 id="issue-8-a-loop-of-restarting-the-raycluster-occurs-when-the-kubernetes-cluster-runs-out-of-resources-kuberay-v061-or-earlier">Issue 8: A loop of restarting the RayCluster occurs when the Kubernetes cluster runs out of resources. (KubeRay v0.6.1 or earlier)<a class="headerlink" href="#issue-8-a-loop-of-restarting-the-raycluster-occurs-when-the-kubernetes-cluster-runs-out-of-resources-kuberay-v061-or-earlier" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Note: Currently, the KubeRay operator does not have a clear plan to handle situations where the Kubernetes cluster runs out of resources.
Therefore, we recommend ensuring that the Kubernetes cluster has sufficient resources to accommodate the serve application.</p>
</blockquote>
<p>If the status of a serve application remains non-<code>RUNNING</code> for more than <code>serviceUnhealthySecondThreshold</code> seconds,
the KubeRay operator will consider the RayCluster as unhealthy and initiate the preparation of a new RayCluster.
A common cause of this issue is that the Kubernetes cluster does not have enough resources to accommodate the serve application.
In such cases, the KubeRay operator may continue to restart the RayCluster, leading to a loop of restarts.</p>
<p>We can also perform an experiment to reproduce this situation:</p>
<ul>
<li>A Kubernetes cluster with an 8-CPUs node</li>
<li><a href="https://gist.github.com/kevin85421/6a7779308aa45b197db8015aca0c1faf">ray-service.insufficient-resources.yaml</a></li>
<li>RayCluster:<ul>
<li>The cluster has 1 head Pod with 4 physical CPUs, but <code>num-cpus</code> is set to 0 in <code>rayStartParams</code> to prevent any serve replicas from being scheduled on the head Pod.</li>
<li>The cluster also has 1 worker Pod with 1 CPU by default.</li>
</ul>
</li>
<li><code>serveConfigV2</code> specifies 5 serve deployments, each with 1 replica and a requirement of 1 CPU.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1"># Step 1: Get the number of CPUs available on the node</span>
kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>custom-columns<span class="o">=</span>NODE:.metadata.name,ALLOCATABLE_CPU:.status.allocatable.cpu

<span class="c1"># [Example output]</span>
<span class="c1"># NODE                 ALLOCATABLE_CPU</span>
<span class="c1"># kind-control-plane   8</span>

<span class="c1"># Step 2: Install a KubeRay operator.</span>

<span class="c1"># Step 3: Create a RayService with autoscaling enabled.</span>
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>ray-service.insufficient-resources.yaml

<span class="c1"># Step 4: The Kubernetes cluster will not have enough resources to accommodate the serve application.</span>
kubectl<span class="w"> </span>describe<span class="w"> </span>rayservices.ray.io<span class="w"> </span>rayservice-sample<span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span>

<span class="c1"># [Example output]</span>
<span class="c1"># fruit_app_DAGDriver:</span>
<span class="c1">#   Health Last Update Time:  2023-07-11T02:10:02Z</span>
<span class="c1">#   Last Update Time:         2023-07-11T02:10:35Z</span>
<span class="c1">#   Message:                  Deployment &quot;fruit_app_DAGDriver&quot; has 1 replicas that have taken more than 30s to be scheduled. This may be caused by waiting for the cluster to auto-scale, or waiting for a runtime environment to install. Resources required for each replica: {&quot;CPU&quot;: 1.0}, resources available: {}.</span>
<span class="c1">#   Status:                   UPDATING</span>

<span class="c1"># Step 5: A new RayCluster will be created after `serviceUnhealthySecondThreshold` (300s here) seconds.</span>
<span class="c1"># Check the logs of the KubeRay operator to find the reason for restarting the RayCluster.</span>
kubectl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$KUBERAY_OPERATOR_POD</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$YOUR_NAMESPACE</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>operator-log

<span class="c1"># [Example output]</span>
<span class="c1"># 2023-07-11T02:14:58.109Z  INFO    controllers.RayService  Restart RayCluster  {&quot;appName&quot;: &quot;fruit_app&quot;, &quot;restart reason&quot;: &quot;The status of the serve application fruit_app has not been RUNNING for more than 300.000000 seconds. Hence, KubeRay operator labels the RayCluster unhealthy and will prepare a new RayCluster.&quot;}</span>
<span class="c1"># 2023-07-11T02:14:58.109Z  INFO    controllers.RayService  Restart RayCluster  {&quot;deploymentName&quot;: &quot;fruit_app_FruitMarket&quot;, &quot;appName&quot;: &quot;fruit_app&quot;, &quot;restart reason&quot;: &quot;The status of the serve deployment fruit_app_FruitMarket or the serve application fruit_app has not been HEALTHY/RUNNING for more than 300.000000 seconds. Hence, KubeRay operator labels the RayCluster unhealthy and will prepare a new RayCluster. The message of the serve deployment is: Deployment \&quot;fruit_app_FruitMarket\&quot; has 1 replicas that have taken more than 30s to be scheduled. This may be caused by waiting for the cluster to auto-scale, or waiting for a runtime environment to install. Resources required for each replica: {\&quot;CPU\&quot;: 1.0}, resources available: {}.&quot;}</span>
<span class="c1"># .</span>
<span class="c1"># .</span>
<span class="c1"># .</span>
<span class="c1"># 2023-07-11T02:14:58.122Z  INFO    controllers.RayService  Restart RayCluster  {&quot;ServiceName&quot;: &quot;default/rayservice-sample&quot;, &quot;AvailableWorkerReplicas&quot;: 1, &quot;DesiredWorkerReplicas&quot;: 5, &quot;restart reason&quot;: &quot;The serve application is unhealthy, restarting the cluster. If the AvailableWorkerReplicas is not equal to DesiredWorkerReplicas, this may imply that the Autoscaler does not have enough resources to scale up the cluster. Hence, the serve application does not have enough resources to run. Please check https://github.com/ray-project/kuberay/blob/master/docs/guidance/rayservice-troubleshooting.md for more details.&quot;, &quot;RayCluster&quot;: {&quot;apiVersion&quot;: &quot;ray.io/v1alpha1&quot;, &quot;kind&quot;: &quot;RayCluster&quot;, &quot;namespace&quot;: &quot;default&quot;, &quot;name&quot;: &quot;rayservice-sample-raycluster-hvd9f&quot;}}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>